import PropTypes            from 'prop-types'
import React                from 'react'


import s                    from './Parallax.css'

class Parallax extends React.Component {
  static childContextTypes = {
    scrollTop: PropTypes.number.isRequired,
  }

  constructor(props) {
    super(props)

    this.state = {
      scrollTop: 0
    }
  }

  onScroll = ({ target: { scrollTop }}) => {
    this.setState({ scrollTop })
  }

  render() {
    const { scrollTop } = this.state
    const { children } = this.props

    return (
      <div
        className={ s.root }
        onScroll={ this.onScroll }
      >
        {
          React.Children.map(children, o =>
            React.cloneElement(o, {
              scrollTop
            })
          )
        }
      </div>
    )
  }
}

import ParallaxLayer        from '../ParallaxLayer'

Parallax.Layer = ParallaxLayer

import withStyles           from 'isomorphic-style-loader/lib/withStyles'

export default withStyles(s)(Parallax)
